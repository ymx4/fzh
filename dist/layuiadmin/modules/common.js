layui.define(["layer","admin","view","table","form","tree","element"],function(t){var e=layui.$,a=layui.layer,n=layui.admin,r=layui.view,l=layui.table,o=layui.form,s=layui.element,d={user:{},empty:function(t){return!t||""==t},closeParent:function(){var t=parent.layer.getFrameIndex(window.name);parent.layer.close(t)},getUploadUrl:function(){return this.user&&this.user.token?layui.setter.api.UpFile+"?token="+this.user.token:layui.setter.api.UpFile},getImageUrl:function(t){return this.user&&this.user.token?layui.setter.api.ReadFile+"?FN="+encodeURIComponent(t)+"&token="+this.user.token:layui.setter.api.ReadFile+"?FN="+encodeURIComponent(t)},saveSuccess:function(t){if("string"==typeof t)var a=t,i=".layui-icon-search",n=0;else var a=t.href,i=t.refresh,n=t.type;if(1==n){var r=e(i,parent.document);return r.trigger("click"),void this.closeParent()}var l=top.layui.admin.tabsPage.index,o=top.layui;if(a){var s,d,c=e("#LAY_app_tabsheader>li",top.document);if(c.each(function(t){var i=e(this),n=i.attr("lay-id");if(n===a)return d=t,s=!0,!1}),s){o.index.openTabsPage(a);var u=o.admin.tabsBody(d).find(".layadmin-iframe"),r=e(i,u[0].contentWindow.document);r.length>0?r.trigger("click"):o.admin.events.refresh()}}o.common.closeTab(l)},closeTab:function(t){e("#LAY_app_tabsheader>li").eq(t).find(".layui-tab-close").trigger("click")},modal:function(t){t=e.extend({type:2},t);var i=a.open({type:t.type,content:t.content,title:t.title});return a.full(i),i},req:function(t){var i=t.success,n=t.formerror||!1;t.data=t.data||{};var r=JSON.stringify(t.data);if("{}"!=r){var l=!1;for(var o in t.data)/[a-z]/.test(o.charAt(0))&&(l=!0,delete t.data[o]);l&&(r=JSON.stringify(t.data))}return t.data=r,this.user&&this.user.token&&(t.url=t.url+"?token="+this.user.token),delete t.success,e.ajax(e.extend({type:"post",dataType:"json",success:function(t){1==t.status&&"function"==typeof i?i(t):4006==t.errorCode?a.confirm("登录超时，请重新登录",{btn:["去登录","取消"]},function(){top.location.href=layui.setter.baseUrl+"passport/login.html"}):(n&&(t.message=t.message.replace(/(^\|)|(\|$)/g,""),t.message=t.message.split("|").join("<br>")),a.msg(t.message))}},t))},xyReload:function(t,e){a.load(0,{time:layui.setter.loadsec}),l.reload(t,e)},xyRender:function(t){this.user&&this.user.token&&(t.url=t.url+"?token="+this.user.token);var i=t.parseData;return delete t.parseData,a.load(0,{time:layui.setter.loadsec}),l.render(e.extend({limit:10,method:"post",contentType:"application/json",request:{pageName:"PAGE_NO",limitName:"PAGE_SIZE"},response:{statusName:"status",statusCode:1,countName:"message"},parseData:function(e){if(a.closeAll("loading"),4006==e.errorCode)a.confirm("登录超时，请重新登录",{btn:["去登录","取消"]},function(){top.location.href=layui.setter.baseUrl+"passport/login.html"});else{if(t.url.indexOf("GetClientHistory")!=-1&&e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++)Object.keys(e.data[n]).forEach(function(t){t.indexOf("_TIME")!=-1&&(e.data[n][t]=e.data[n][t].replace(/00:00:00/,""))});"function"==typeof i&&i(e)}},page:{layout:["prev","page","next","count"]},text:{none:"暂无相关数据"}},t))},initConfig:function(){var t=this;e(".xy-config").length;e(".xy-config").each(function(a){var n=e(this).attr("data-val");t.req({url:layui.setter.api.GetConfigDetail,data:{CONFIG_ID:e(this).attr("data-cf")?e(this).attr("data-cf"):9},success:e.proxy(function(t){if(t.data.length>0){var a='<option value="">请选择</option>';for(i=0;i<t.data.length;i++){var r="";n==t.data[i].ID&&(r=" selected"),a+='<option value="'+t.data[i].ID+'"'+r+">"+t.data[i].CONFIG_VALUE+"</option>"}e(this).html(a)}o.render("select")},this)})})},areaFirst:!0,initArea:function(t){var a=this;if(this.areaFirst&&o.on("select(xy-addr-select)",function(t){if(e(t.elem).closest(".xy-select").nextAll(".xy-select").remove(),""!=t.value){var i=e(t.elem).closest(".xy-select");a.area(t.value,i),i.siblings(".xy-select-val").val(e(t.elem).val())}}),t&&t["default"])a.req({url:layui.setter.api.GetAreaText,data:{AREA_ID:t["default"]},success:function(i){var n=1,r=e(t.elem);for(ii=0;ii<i.data.length;ii++)r.after('<div class="layui-inline xy-select">                  <select lay-filter="xy-addr-select" data-pid="'+n+'" data-id="'+i.data[ii].ID+'">                    <option value="">请选择</option>                  </select>                </div>'),r=r.next(),n=i.data[ii].ID;e(t.elem).siblings(".xy-select").children("select").each(function(){var t=e(this);a.req({url:layui.setter.api.GetAreaList,data:{PARENT_ID:e(this).attr("data-pid")},success:function(e){null!=e.data&&e.data.length>0&&layui.laytpl('{{#  layui.each(d.list, function(index, item){ }}                        <option value="{{ item.ID }}"{{#  if(d.defaultId == item.ID){ }} selected{{#  } }} >{{ item.AREA_NAME }}</option>                      {{#  }); }}').render({list:e.data,defaultId:t.attr("data-id")},function(e){t.append(e),o.render("select")})}})})}});else{if(t)var i=e(t.elem);else{var i=[];e(".xy-area").each(function(){i.push(e(this))})}i.length>0&&this.area(1,i)}this.areaFirst=!1},area:function(t,a){var i=this;i.req({url:layui.setter.api.GetAreaList,data:{PARENT_ID:t},success:function(t){null!=t.data&&t.data.length>0&&layui.laytpl('<div class="layui-inline xy-select">                <select lay-filter="xy-addr-select">                  <option value="">请选择</option>                  {{#  layui.each(d.list, function(index, item){ }}                    <option value="{{ item.ID }}">{{ item.AREA_NAME }}</option>                  {{#  }); }}                </select>              </div>').render({list:t.data},function(t){a instanceof Array?e.each(a,function(e,a){a.after(t)}):a.after(t),o.render("select")})}})},rowspan:function(t,a,i){for(var n="1"==a?e(".layui-table-body")[a-1]:e("3"==a?".layui-table-fixed-r":".layui-table-fixed-l"),r=e(n).find("td"),l=[],o=0;o<r.length;o++)r[o].getAttribute("data-field")==t&&l.push(r[o]);for(var s={},o=0;o<l.length;o++){var d=i?l[o].innerHTML:l[o].textContent;if(void 0==s[d])s[d]=1;else{var c=s[d];s[d]=1*c+1}}for(var u=!0,f=9999,o=0;o<l.length;o++){f=e(l[o]).prev().attr("rowspan")&&"8"!=t?e(l[o]).prev().attr("rowspan"):f;for(var y=i?l[o].innerHTML:l[o].textContent,p=s[y],m=f<p?f:p,v=1;v<m&&o+v<l.length;v++){var h=i?l[o+v].innerHTML:l[o+v].textContent;y!=h&&m>1&&(u=!0,m=v)}u?(l[o].setAttribute("rowspan",m),e(l[o]).find("div.rowspan").length>0&&(e(l[o]).find("div.rowspan").parent("div.layui-table-cell").addClass("rowspanParent"),e(l[o]).find("div.layui-table-cell")[0].style.height=39*m-10+"px"),u=!1):l[o].style.display="none",f&&f--,(0==--s[y]||0==f||void 0!=h&&y!=h)&&(u=!0)}}};if(location.href.indexOf("login")==-1){var c=layui.data(layui.setter.tableName);c.user?(d.user=c.user,location.href.indexOf("views/index.html")!=-1&&(e("#myRealname").text(d.user.REAL_NAME),e("#myUnitname").text(d.user.UNIT_NAME))):location.href=layui.setter.baseUrl+"passport/login.html"}n.events.closelayer=function(){d.closeParent()},n.events.closeself=function(){parent.layui.admin.closeThisTabs()},n.events.xyicd=function(t){var i=a.open({type:1,area:["90%","90%"],content:'<div id="xyicd"></div>',title:"ICD查询"}),n=t.data("type");r("xyicd").render("common/icd",{often:!!n}).done(function(){setTimeout(function(){d.xyRender({elem:"#xy-icd-table",url:layui.setter.api.SearchICD,where:{ICD_KEYWORD:""},cols:[[{type:"numbers",title:"序号"},{field:"DISEASE_NAME",title:"疾病名称"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-icd-ope"}]]})},100),s.on("tab(xy-icd-tab)",function(t){1==t.index&&d.empty(t.elem.data("check"))&&(t.elem.data("check",1),d.xyRender({elem:"#xy-icd-often-table",url:layui.setter.api.GetOftenICD,where:{TYPE_ID:n},cols:[[{type:"numbers",title:"序号"},{field:"DISEASE_NAME",title:"疾病名称"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-icd-ope"}]]}))}),l.on("tool(xy-icd-table)",function(n){"sel"===n.event&&(t.attr("data-id")&&e("#"+t.attr("data-id")).val(n.data.ID),e("#"+t.attr("data-name")).val(n.data.DISEASE_NAME),e("#"+t.attr("data-name")).attr("title",n.data.DISEASE_NAME),a.close(i))}),l.on("tool(xy-icd-often-table)",function(n){"sel"===n.event&&(t.attr("data-id")&&e("#"+t.attr("data-id")).val(n.data.ID),e("#"+t.attr("data-name")).val(n.data.DISEASE_NAME),e("#"+t.attr("data-name")).attr("title",n.data.DISEASE_NAME),a.close(i))}),o.on("submit(xy-icd-search)",function(t){d.xyReload("xy-icd-table",{page:{curr:1},where:{ICD_KEYWORD:t.field.icdq}})})})},n.events.xyalldoctor=function(t){t.attr("data-id")&&e("#"+t.attr("data-id")).val("0"),e("#"+t.attr("data-name")).val(t.text()),e("#"+t.attr("data-name")).attr("title",t.text())},n.events.xyseldoctor=function(t){var i=a.open({type:1,area:["90%","90%"],content:'<div id="xyseldoctor"></div>',title:"选择医生"});r("xyseldoctor").render("common/doctor").done(function(){setTimeout(function(){d.xyRender({elem:"#xy-seldoctor-table",url:layui.setter.api.GetUserList,where:{KEY_WORD:"",UNIT_ID:d.user.UNIT_ID,ALL_UNIT:0,GROUP_ID:0,FAMILY_DOCTOR:0,SPECIALIST:0},cols:[[{type:"numbers",title:"序号"},{field:"REAL_NAME",title:"医生姓名"},{title:"操作",align:"center",fixed:"right",toolbar:"#table-seldoctor-ope"}]]})},100),l.on("tool(xy-seldoctor-table)",function(n){"sel"===n.event&&(t.attr("data-id")&&e("#"+t.attr("data-id")).val(n.data.ID),e("#"+t.attr("data-name")).val(n.data.REAL_NAME),e("#"+t.attr("data-name")).attr("title",n.data.REAL_NAME),a.close(i))}),o.on("submit(xy-seldoctor-search)",function(t){d.xyReload("xy-seldoctor-table",{where:{KEY_WORD:t.field.KEY_WORD}})})})};var u=function(t){if(t.HOSPITAL_UNIT_INFO){var e={name:t.HOSPITAL_UNIT_INFO.UNIT_NAME,id:t.HOSPITAL_UNIT_INFO.ID,spread:!0};if(t.CHILDREN_HOSPITAL_UNIT_INFO&&t.CHILDREN_HOSPITAL_UNIT_INFO.length>0){e.children=[];for(var a=0;a<t.CHILDREN_HOSPITAL_UNIT_INFO.length;a++)e.children.push(u(t.CHILDREN_HOSPITAL_UNIT_INFO[a]))}t=e}return t};n.events.xyallins=function(t){t.attr("data-id")&&e("#"+t.attr("data-id")).val("0"),e("#"+t.attr("data-name")).val(t.text()),e("#"+t.attr("data-name")).attr("title",t.text())},n.events.xyinscancel=function(t){t.attr("data-id")&&e("#"+t.attr("data-id")).val(d.user.UNIT_ID),e("#"+t.attr("data-name")).val(d.user.UNIT_NAME),e("#"+t.attr("data-name")).attr("title",d.user.UNIT_NAME)},n.events.xyins=function(t){var i=a.open({type:1,area:["90%","90%"],content:'<div id="xyins"></div>',title:"机构选择"});r("xyins").render("common/ins").done(function(){a.load(0,{time:layui.setter.loadsec}),d.req({url:layui.setter.api.GetHospitalUnit,data:{HOSPITAL_ID:d.user.UNIT_ID,GET_TYPE:2},success:function(t){a.closeAll("loading");var i=u(t.data);i=[i],layui.tree({elem:"#xy-inslist",nodes:i,click:function(t){e("#ins-confirm").attr("data-id",t.id),e("#ins-confirm").attr("data-name",t.name)}})}}),e("#xyins").on("mousedown",".layui-tree a cite",function(){e(".layui-tree a cite").removeClass("layui-bg-green"),e(this).addClass("layui-bg-green")}),e("#ins-confirm").on("click",function(){e(this).attr("data-id")&&e("#"+t.attr("data-id")).val(e(this).attr("data-id")),e("#"+t.attr("data-name")).val(e(this).attr("data-name")),e("#"+t.attr("data-name")).attr("title",e(this).attr("data-name")),a.close(i)})})},t("common",d)});